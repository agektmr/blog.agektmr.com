---
layout: post
title: 'パスワードの不要な世界はいかにして実現されるのか - パスキーとは何なのか'
description: ''
date: 2022-12-11
tags:
- Passkey
- WebAuthn
- FIDO
- FIDO2
- 認証
- Authentication
---

パスキーはフィッシングに強く、テクノロジーに詳しくないユーザーでも使いやすい新しい認証方式で、いずれパスワードを置き換えると言われています。この記事では、パスキーの基本と、これからのウェブにとってパスキーがどういう意味を持つのかをまとめてみます。

<!-- excerpt -->

今年 5 月、Google I/O で、ウェブの認証が今どういう状況で、これからどういう方向に向かっていくのかを[お話しさせてもらい](https://www.youtube.com/watch?v=6vnQDn3AUbo)、その際、Google がパスキーに対応予定であることを述べました。[10 月には開発者向けにパスキーのベータ版を公開したとアナウンスがあり](https://android-developers.googleblog.com/2022/10/bringing-passkeys-to-android-and-chrome.html)、12 月 9 日には [Android 版 Chrome でパスキーがサポートされたとのアナウンスが出ました](https://blog.chromium.org/2022/12/introducing-passkeys-in-chrome.html)。Apple も[最新版の macOS Ventura、iOS / iPadOS 16 からパスキーに対応](https://developer.apple.com/videos/play/wwdc2022/10092/)しています。

## パスキーとは何か

パスキーは Apple、Google、Microsoft が協調して使う [FIDO クレデンシャル](/2019/03/fido-webauthn.html)の名前です。エンドユーザーのみなさんがパスワードの代わりとして認識し、直感的にログインできるよう「パスキー」という名前とアイコンが決まりました。ウェブ開発者的には [FIDO Alliance](https://fidoalliance.org/) と W3C の定める [WebAuthn (Web Authentication)](https://w3c.github.io/webauthn) が進化したものと考えて差し支えありません。[FIDO と WebAuthn に関しては以前書いた記事](/2019/03/fido-webauthn.html)がありますが、その延長線上です。そのため、この記事で言う「パスキー」は「FIDO クレデンシャル」と置き換えて読んでもらっても構いません。

パスキーは、パッと見の体験としては生体認証を使ったログインですが、技術者ならこの裏で何が起きているかを知っておく価値はあると思いますので、少し深堀りしてみましょう。

### ユーザー体験

ユーザーがパスキーでログインするには、サイトごとにパスキーを作成しておく必要があります。

パスキーを作成・登録しようとすると、生体認証ダイアログがポップアップし[ローカル認証](#luv)を行います。認証が完了すると、新しくパスキーが作成されます。
ログイン時はアカウントセレクターが表示されるため、使いたいアカウントを選んでをタップすると、ローカル認証が行われ、ログインが完了します。

{% YouTube '6GMDhF1eQOQ' %}

パスキーはクラウドで同期されるため、ある Android 端末で作ったパスキーは、同じ Google アカウントで使っている別の Android 端末でも利用することができます。しかし、Android で作ったパスキーは Mac には同期されないため、Mac 上の例えば Safari では同じパスキーが使えません。しかし、Android 端末を使ってデスクトップの Safari でログインさせることができます。

ログインフォームのユーザー名フィールドをタップする際、オートフィルの一番下に「他の端末でログイン」のような文字列が出てくるので、これをタップすると QR コードを表示することができます。それを Android でスキャンすると、ローカル認証が行われ、完了すると自動的にデスクトップ側のログインも完了します。

{% YouTube '8D84Yosw-Ws' %}

### パスキーはローカルで認証する {: #luv}

FIDO 認証の基本は公開鍵暗号方式です。パスキーも例外ではなく、作ると公開鍵ペアが作成され、秘密鍵はデバイスに保存され、公開鍵はサーバーに送られ保存されます。パスキーはこの秘密鍵とそのメタデータを指しています。パスキーはクラウドを介して同期され、他の端末からでも利用可能になります。

ローカル認証は、スクリーンロックを解除する場合と同じ方法を使います。つまり、Android であれば指紋認証、顔認証、もしくは PIN やパターン。iOS / iPadOS であれば Touch ID、Face ID、もしくは パスコード。macOS であれば Touch ID もしくはパスワード。

パスキー作成時はスクリーンロックを使うことで新しい公開鍵ペアを作成し、ログイン時はスクリーンロックを使うことでログインに使う署名を発行します。

パスワードであればユーザーの入力した文字列をサーバーに送ることでリモート認証を行いますが、FIDO ではローカル認証で端末上での認証をトリガーに署名を生成し、それをサーバーに送ることで認証、つまり 2 回認証しています。パスキーの安全性は単体で生体認証 (もしくは知識認証) と所有認証の二要素認証ができるという点にもあります。

このやり方であればユーザーが誤って漏らしてしまったり、再利用したりもできませんし、何よりもフィッシングに強いという点が FIDO の特徴です。

{% Aside %}

サーバーに保存した生体情報が漏れたら大変なことになる、と心配される方もいらっしゃるかもしれませんが、FIDO の決まりでは生体情報は端末内に安全に保存され、ネットワークなど外に出ることはありません。

{% endAside %}

### パスキーはデバイス間で同期が可能

パスキーの最も大きな特徴が、同じエコシステム内であればデバイス間で同期できる点です。「同じエコシステム」とは、Google、Apple、Microsoft を代表とするそれぞれのプラットフォームが持つパスワードマネージャーなどの仕組みを指します。例えば Apple であれば iCloud Keychain を、Google であれば Google Password Manager を介してパスキーが同期されます (Microsoft は 2022 年 12 月現在パスキーの対応を正式に表明していないため不明)。どちらもエンドツーエンドで暗号化を行った上で同期します。

Apple は垂直統合しているので Apple デバイス以外で Safari は動かないため、基本的にはすべて Apple ID を軸に iCloud Keychain で同期されることになります。Google Chrome は Android デバイス間で Google アカウントを軸に Google Password Manager を使って同期します。他の OS 上では現時点ではパスキーの同期は行われませんが、可能になった時点で各エコシステムの仕組みに乗っ取ることになる予定です。

{% Aside %}

なお、Android は将来的にサードパーティのパスワードマネージャーがパスキーを同期することをサポートすると表明していますので、1Password などのパスキー対応を表明しているパスワードマネージャーが使えるようになるかもしれません。

{% endAside %}

### アカウントセレクターが使える

Safari や デスクトップ Chrome では以前から使えていた機能ではありますが、Android が対応していなかったのであまり日の目を見なかったアカウントセレクターの機能がパスキーの使い方の代表的なものとして取り上げられています。これは WebAuthn では Discoverable Credentials (旧 [Resident Key](/2019/03/fido-webauthn.html#resident-key)) と呼ばれるもので、パスキーにメタデータとしてユーザー情報を保存することでアカウントセレクターの UI を可能にします。ユーザーは自分でユーザー名をタイプすることなく、タップとローカル認証だけでログインが可能になります。パスワードどころかユーザー名も忘れてしまうユーザーもいるので、これでユーザビリティは大きく向上します。

### スマホでログインできる

Google アカウントでは以前からスマートフォンをセキュリティキーとして使い二要素認証する機能がありました。似たような機能が実は 2 種類あって、ひとつはすべての端末にプッシュ通知を送ってログインを許可するもので、もうひとつは予め指定したひとつの端末にのみログインプロンプトを表示し、デバイスのハードウェアキーを押すことで FIDO プロトコル経由でログインできる機能です。この機能は [caBLE](/2019/03/fido-webauthn.html#cable-を使ってスマートフォンを認証器に) と呼ばれていましたが、現在は hybrid に名前が変わっています。

Hybrid は元々標準化を前提に作られていたため、同様の機能はパスキーと同時に Safari に実装されました。これにより、macOS 上の Safari に Android を使ってログインすることも可能になりましたし、iPhone を使って Windows 上の Chrome にログインも可能です。すべての対応ブラウザで同様のことが可能になります。

## パスキーのインパクト

### パスワードがいらなくなる

パスキーはパスワードを置き換えるものなので、パスワードは不要になり、ユーザーがパスワードを覚えなくてよくなります。サービス提供側も、パスワードの漏洩を恐れる必要がなくなります。代わりに保存される公開鍵は漏れても大丈夫、とまでは言いませんが、リスクはパスワードに比べれば遥かに低いものです。


## 使い方

WebAuthn を使えば自動的にパスキーが作られ、システムが自動的に同期してくれるため、開発者は追加でしなければいけないことはありません。

## アカウントリカバリー

パスキーがあればパスワードはいらなくなると書きましたが、パスワードをなくすべきかどうかは慎重に考えて判断してください。パスワードがなくなるということは、ユーザーがフィッシング詐欺に引っかかれなくなるし、漏れて困る情報がなくなるのは単純にありがたいことではないかと思います。しかし、ユーザーがパスキーにアクセスできない環境は何かしらの形で出てくると思われます。パスキーはまだまだ実装例が少ないため、そういった知見があまりないというのがデメリットではあります。

ユーザーがパスキーにアクセスできない場合のエスケープハッチとして、別の方法を残しておくことをアカウントリカバリーと呼びます。パスキーを攻撃するのが難しいとわかれば、アカウントリカバリーが狙われるので、ここをどう守っていくかが重要になります。

その歳、パスキー以外のログイン方法として考えられるのは、パスワードか SMS、もしくはメールでトークンを送る、保存しておいてもらったリカバリーコードを入力してもらう方法などです。パスワードでログインできるままにしてしまうのはユーザーがフィッシングに引っかかるリスクを伴うし、リカバリーコードをちゃんと保存してくれるユーザーがどれほどいるかも疑問が残るため、SMS もしくはメールでトークンを送るのが妥当な解決策でしょうか。

この辺りは今後もベストプラクティスの検証が進んでいくことを期待したいところです。

## すぐにパスキーに飛び込んで大丈夫なのか

