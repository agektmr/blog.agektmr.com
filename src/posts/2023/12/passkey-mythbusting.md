---
layout: post
title: 'パスキーの基本とそれにまつわる誤解を解きほぐす'
description: 'パスキーの基本を振り返ったうえで、パスキーでみなさんが勘違いしやすい点について解説します'
date: 2023-12-18
tags:
- Passkey
- WebAuthn
- FIDO
- FIDO2
- 認証
- Authentication
---

よく「〜元年」という言い方をしますが、2023 年は「パスキー元年」と言っても差し支えない程度にはパスキー対応サービスが増えました。例を挙げます:

- Adobe
- Amazon
- Apple
- eBay
- GitHub
- Google
- KDDI
- Mercari
- Mixi
- MoneyForward
- Nintendo
- NTT Docomo
- PayPal
- Shopify
- Uber
- Yahoo! JAPAN

もちろんこのリストですべてではないですが、これらだけでも、世界人口のかなりをカバーできるはずで、まさに大躍進と言えます。もしまだパスキーを体験していないという方がいたら、ぜひこの機会にお試しください。

とはいえ、現段階ではサービスで使えるようになったというだけで、実際に使っているユーザーがカバー人口と同じ数だけいるわけではないですし、開発者目線でも、ユーザー体験や実装面が熟れてくるまでに最低 2, 3 年はかかるだろうという感触があります。そのためにも、まずは少しでも多くの人に、より正確なパスキーの知識を得てもらいたいと思い、この記事を書いています。

個人的には、**ログインすることが IT を使う障壁でなくなり、例えば自分の母親などでも、詳しい人に相談することなく簡単にウェブサイトやアプリにログインできる世界** がパスキーで実現できると嬉しいなと思っています。

## パスキーの基本

まずはパスキーの基本を振り返ってみましょう。チームでパスキーについて短くまとめたビデオを作ったのでぜひご覧ください。英語ですが、翻訳して日本語字幕を出すこともできます。

{% YouTube '2xdV-xut7EQ' %}

パスキーはひとことで言うと **デバイスの所有者だけが、デバイス内に作った鍵をログインに使える仕組み** です。

* パスキーはサイトやアプリごとに作ることができる
* パスキーを作ったりログインする際は、デバイスのアンロック動作を行う
* パスキーはデバイス間で同期できる
* パスキーなら、ユーザーがフィッシング詐欺に引っかかることが難しい
* パスキーなら、サーバーからアカウントにログインするための情報を盗むことが難しい

もう少し詳しいところは、このブログでも 2 回ほど取り上げていますので、そちらも読んでみてください。

- [パスワードの不要な世界はいかにして実現されるのか - FIDO2 と WebAuthn の基本を知る](https://blog.agektmr.com/2019/03/fido-webauthn) (2019年)
- [パスキーとは何か、そしてその課題](https://blog.agektmr.com/2022/12/passkey) (2022年)

## パスキーにまつわる誤解を解く

パスキーの基本を踏まえて、ここからは、巷で見かけたパスキーにまつわる誤解を解いていきます。

### パスワードマネージャーを使っていれば十分安全だからパスキーは使う意味がない

パスキーを使う意義は、パスワードマネージャーの利用を強制できるところにある、と言っても間違いではないかもしれません。

確かに、パスワードマネージャーを使っていればフィッシングに引っかかる確率も低いでしょうし、複雑なパスワードを自動生成してくれますし、記憶する必要もないので、うまく使えればその方にはパスキーは必要はないかもしれません。

問題は、パスワードマネージャーを使うリテラシーのない人や、使い方の分からない人をどう救うかです。パスワードマネージャーが利用できる環境は長年存在していますが、未だにパスワードの漏洩やアカウントの乗っ取りが減らないのは、パスワードマネージャーという存在があるだけでは問題が解決しないためです。サイトやアプリ側としても、できればパスワードや二要素認証でやらかしてしまうユーザーのサポートにコストをかけたくはないはずです。しかし、ユーザーにパスワードマネージャーの利用を強制することはできません。

[KDDI は、パスキーを導入することで問い合わせが 3 割減った](https://k-tai.watch.impress.co.jp/docs/news/1553203.html#:~:text=kddi%E3%81%A6%E3%82%99%E3%81%AF%E3%80%81au%20id%E3%81%AEfido%E7%99%BB%E9%8C%B2%E3%81%AF1000%E4%B8%87%E3%82%92%E8%B6%85%E3%81%88%E3%81%A6%E3%81%8A%E3%82%8A%E3%80%81%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%E9%96%A2%E9%80%A3%E3%81%AE%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E3%82%84%E9%96%A2%E9%80%A3%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%AB%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%E5%85%A5%E9%9B%BB%E6%95%B0%E3%81%8B%E3%82%993%E5%89%B2%E6%B8%9B%E5%B0%91%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B)と報告しています。

### デバイスを紛失するとパスキーは使えなくなる

同期しているパスキーは、デバイスを紛失しても復旧することができます。

パスキーはパスワードマネージャーのサーバーに同期できますので、デバイスを紛失しただけで即座に二度とログインできなくなるということはありません。新しいデバイスでパスワードマネージャーのアカウントにログインできれば、パスキーの復元が可能です。

例えば Android で Google Password Manager を使った場合、保存したパスキーはその端末の PIN またはパターンを使って暗号化した上でサーバーにバックアップされます。新しい端末に移行する場合は、まず Google アカウントにログイン、その後古い端末の PIN またはパターンを入力することで、パスキーを同期・復号し、ログインに利用することができます。

端末を紛失し、悪意ある人の手に渡ったと感じた場合は、念のため[端末ごとワイプする](https://support.google.com/accounts/answer/6160491)と良いかもしれません。

### パスキーだって〜したらアカウント盗めるでしょ？

皆さん、パスキーが脆弱な理由を考えるのが楽しいようで、色々なアイディアを提案してきてくれます。もちろん、解決すべき問題、解決できる問題については議論されていますが、例えば「端末を盗まれたら？」とか「指を切り取られて認証されたら？」という類のツッコミの場合、多くは「パスキーは物理的な犯罪を防ぐためのものではありません」という回答になります。これらを理由にパスキーは使うべきではないというのは、ちょっと乱暴だと思います。

パスワードを使い続けてサーバーからの漏洩、フィッシング攻撃、リスト攻撃など、遠隔地から正体の分からない攻撃を延々と受ける可能性を残すのと、曲がりなりにもデバイスを物理的に所有していないと攻撃のしようがないパスキー、どちらがマシか？と考えてみてください。完璧ではないにしろ、パスキーの方がいくらかマシな部分があるかと思います。

### パスキーを使うと、自分の大切な認証を完全に Big Tech に依存することになる

パスキーは、OS ベンダーの提供するデフォルトのパスワードマネージャー以外の、サードパーティーのパスワードマネージャーに保存・同期・利用することも可能です。

パスキーは、Apple デバイスでは iCloud Keychain、Android では Google Password Manager にデフォルトで保存、同期されます。これをもって、Big Tech にパスキーを保存するのは依存を高めてしまうので避けたい、という人がいるのも自然なことだと思います。

幸い Apple も Google も、パスキーをサードパーティー パスワードマネージャーに保存し、使うことができる手段を提供しています。すでに 1Password や Dashlane などがパスキーに対応し、実際に使えるようになっているので、必要な方はそちらを選択することができるようになっています。

(Microsoft はまだパスキーの同期に対応していないため、サードパーティー パスワードマネージャーを利用できるようにするかは不明です。)

### パスワードマネージャーのアカウントが乗っ取られたら終了では？

パスキーを同期するパスワードマネージャーのアカウントが乗っ取られてしまったら、保存されてるパスキーもすべて盗まれてしまうから危険、というのはもっともな懸念です。

Google アカウントが乗っ取られてしまう可能性もゼロではありませんし、iCloud アカウントについても同様です。サードパーティー パスワードマネージャーである 1Password や Dashlane なども絶対安全とは言い切れません。

先述のように、Google Password Manager では (おそらく iCloud Keychain も) パスキーはデバイスの PIN もしくはパターンを使って暗号化した上でバックアップされます。他のパスワードマネージャーも独自の類似した仕組みがあるものと思います。そのため、仮にそれらのアカウントが盗まれてしまっても、それが直ちにパスキーも同時に漏洩、というわけではありません。利用されるパスワードマネージャーがどういう作りになっているかは、念のため確認した方が良いかもしれません。

それなら、パスキーを同期しなければ問題解決では？と思われるかもしれません。その通りですが、それはそれで問題点もあります。例えば新しい端末に移行したい場合、その端末でパスキーを作ったサイトごとに、新たなパスキーを作り直す必要があります。その前に一度認証しなければ、アカウントに紐付けられないからです。どうやってパスキーを使わず認証すればいいでしょう？パスキーと同等か、それ以上の認証方法でログインできなければ、結局そこが穴になってしまいます。

また、もし仮にパスキーを 100 個作っていた場合、パスキー以外による認証と、新しいパスキーの登録を 100 回繰り返さなければならないことになります。セキュリティキーを壊したことがある方は、この苦行がどういうものか分かるのではないかと思います。

そういった意味で、パスキーを同期することは、一定のセキュリティを保ちつつ、ユーザー体験を悪化させずに実現できる絶妙なソリューションなのではないかなと思います。

なお、パスキーの同期とデバイスへの紐付けのいいとこ取りを実現する仕様 [Supplemental Public Key](https://w3c.github.io/webauthn/#sctn-supplemental-public-keys-extension) が作られました。これは以前の記事で紹介した [Device Public Key](/2022/12/passkey#dpk) の汎用版的なものですが、今後この機能の実装も進むものと思われます。

### パスキーがパスワードよりも安全なのは生体情報を使うから

見た目から、パスキーを生体認証と紐付けて考える人は少なくありません。その中から生まれる誤解の一つがこれです。

パスキーは、多くてもせいぜい数十文字で表されるパスワードと比較して、複雑な生体情報を使うためエントロピーが高く安全である、というものですが、これは間違いです。パスキー認証における生体認証の役割は、公開鍵暗号の署名を発行するトリガーです。

パスキーは公開鍵暗号ベースで、公開鍵を RP (Relying Party) のサーバーに保存、秘密鍵はパスワードマネージャーに保存することで作られます。ちなみにこの時パスキーとは、この秘密鍵とそのメタデータを指します。

U2F に対応したセキュリティキーで二要素認証を行う際、表面のメタルチップを手で触れることをトリガーとしますが、これは物理的に触れなければならない制約を設けることで、リモートからソフトウェアで偽装することができないようにするという意味があります。一部スマートフォンを使った二要素認証で、画面タップではなく音量ボタンを押さなければいけないのも同じことです。ボタンが端末内のセキュリティチップに繋がっているため、物理的に押されたことが証明できるのです。

U2F の場合、そこに「誰かがいる」ことを証明して二要素目としていましたが、FIDO2 (パスキー) の場合、端末の生体認証を使うことで、少しでも本人、つまりデバイスのオーナーであることを確かめようとしているのが、この生体認証の持つ意味です。生体認証でなくても、PIN やパスコード、パターンなど、デバイスをアンロックできる方法を知っていれば認証できるのはそのためです。[これを User Verification といいます。](/2019/03/fido-webauthn#user-verification-%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B)

ちなみに、Android や iPhone では、生体情報を Secure Enclave などの安全なハードウェアに保存するため、そのデータを取り出したり、ネットワークに送ったりできない仕組みになっています。

### パスキーはどこでも同期する

パスキーは基本的に同期します。しかし、技術的な理由から、まだすべてのパスキーが同期できる状況になっているわけではありません。元々の表現としては「エコシステム (プラットフォーム) ごとに同期する」と言っていました。もう少し詳しく説明します。

Apple はブラウザである Safari や対応アプリがほぼすべて Apple デバイス上でしか動かないエコシステムですので、macOS でも、iOS でも、iPadOS でも、作ったパスキーはデフォルトで iCloud Keychain に保存、同期され、他の Apple デバイスでも使うことができ、話がとてもシンプルです。

それに対して Chrome は、macOS、iOS、iPadOS、Windows、Android、Linux など、複数のプラットフォームをまたがって動きますので、少し話が複雑です。まず、macOS を含む Apple デバイス上で作られたパスキーは、基本的に iCloud Keychain に保存されるため、Safari とほぼ同じ同期の仕方をすると言えます。Android で保存したパスキーは Android 同士でのみ同期します (まもなく Chrome OS もサポートされます) 。Windows の場合、Windows Hello という Microsoft の仕組みに依存していますが、残念ながら Windows Hello のパスキーはまだ同期されていません。

Chrome の同期サポート状況は [Google のドキュメントにまとめています](https://developers.google.com/identity/passkeys/supported-environments)。

(3 つの主要ブラウザエンジンのひとつである Firefox では、まだパスキーが正式にサポートされていませんが、2024 年の早期には実現されそうな様子です。)

なお、パスキーが同期しておらず使えない環境であっても、QR コードをスキャンすることで、他の端末のパスキーを使ってログインすることも可能です。

{% YouTube '8D84Yosw-Ws' %}

### パスキーとは、同期する FIDO クレデンシャルのことである

正直なところ、パスキーの定義については混乱がありますが、個人的な意見としては同期を前提としたいという気持ちが強いです。

当初、FIDO Alliance では「パスキー」を同期する FIDO クレデンシャル、言い換えると [Discoverable な FIDO クレデンシャルである](/2019/03/fido-webauthn#resident-key)と定義していました (Discoverable クレデンシャルとは、ユーザー名の保存されたパスキーで、Android の場合同期のトリガーにもなります) 。しかしその後、[すべての FIDO クレデンシャルはパスキーである](https://fidoalliance.org/passkeys/#faq)と書き換えられました。そして、同期するパスキーをシンクパスキー (synced passkey)、デバイスに紐付くパスキーをデバイスバウンドパスキー (device-bound passkey) と言い分けるようになりました。

Google も、同期する予定だけどまだ同期してない Discoverable クレデンシャルをパスキーと呼んでいるという背景もあります。

### パスキーを実装したらパスワードは完全に不要になる

パスキーはパスワードなしで認証できるし同期されるため、サイト運営者はパスキーを実装したら、なるべく早くパスワードをなくすのが理想的です。残しておけば、そこから攻撃される可能性が残るからです。しかし、思い切ってパスワードをなくすには、考えるべきことがまだまだ多くあります。

例えば、ひとつしかないパスキーを自分で削除してしまうユーザーが絶対にいないとは言い切れません。もしそうなった場合、どうやってログインさせればいいかは慎重に検討すべきです。

パスワードを使わなくても、例えば SMS にワンタイムパスワードを送るとか、メールに認証できるマジックリンクを送るとか、サポート窓口に電話で問い合わせしてもらうなど、いくつか方法が考えられます。こういうのをアカウントリカバリーと呼びます。

もうお気付きと思いますが、パスキーでいくらセキュリティが向上しても、アカウントリカバリーがザルでは意味がありません。パスキーの実装と同時に、認証機能全体の底上げもぜひ検討してください。

## まとめ

この記事で少しでもパスキーに関する疑問点がクリアになったとしたら嬉しいです。ここに書いてないことで、何か質問がある場合は、[@agektmr](https://twitter.com/agektmr) までお知らせいただければ、回答するかも。

最後に、パスキーの情報を追いかけたいという人たちのために、自分の関わっているリソースをいくつか提供しておきます。

### Google 関連

- [**Google の開発者向けパスキー公式ドキュメント**](https://goo.gle/passkeys): パスキーの概要、UX ガイド、ケーススタディや、Android アプリ向け、ウェブ開発者向け共通のパスキー関連情報を載せています。(機械翻訳を使った日本語も読めますが、日本語にした場合、左側のナビゲーションが最新ではないというバグがあります。お手数ですが、一時的に英語にして全体像を把握してください。)
- [**ウェブ開発者向けパスキー公式ドキュメント**](https://goo.gle/passkeys-web): ウェブ開発者向けのパスキー関連情報を掲載しています。
- [**Android 開発者向けパスキー公式ドキュメント**](https://developer.android.com/training/sign-in/passkeys): Android 開発者向けのパスキー関連情報を掲載しています。今後 Android アプリの認証はすべて Credential Manager というライブラリに移行するため、そのドキュメントの一部になっています。
- [**パスキー開発者向けニュースレター**](https://groups.google.com/g/google-passkeys-developer-newsletter/)

### FIDO Alliance 関連

- [**FIDO Alliance ホームページ**](https://fidoalliance.org/?lang=ja)
- [**FIDO Alliance 公式 UX ガイド**](https://fidoalliance.org/ux-guidelines/) (英語)
- [**FIDO Alliance 関連コミュニティによるドキュメント**](https://passkeys.dev/) (英語)
