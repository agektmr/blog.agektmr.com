---           
layout: post
title: 超カンタン！HTML5 で GIF アニメを作る方法
date: 2013-08-02 13:48:58 UTC
updated: 2013-08-02 13:48:58 UTC
comments: false
categories: GIF HTML5 JavaScript
---

<div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;">知っている人は知っている方法だと思いますが、実際にやってみたのでメモ。<br /><div>※ デモの画像は<a href="https://github.com/masakihirokawa/objc-frame-by-frame-animation" target="_blank">こちら</a>からお借りしました。特にライセンスが記述されていなかったのですが、問題があれば差し替えます。</div><br /><div></div><br /><div style="-webkit-text-stroke-width: 0px; color: black; font-family: helvetica, verdana, arial, serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"><div style="margin: 0px;"><br /></div></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-tVe6Xu1Yjyo/UftKax2zaWI/AAAAAAAAhi0/nwanIQS_vFw/s1600/ossan.gif" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-tVe6Xu1Yjyo/UftKax2zaWI/AAAAAAAAhi0/nwanIQS_vFw/s1600/ossan.gif" /></a></div><br /><br /></div><div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;">ライブラリは&nbsp;<a href="https://github.com/antimatter15/jsgif" style="color: #ad1020;">jsgif</a>&nbsp;というのを使わせて頂きました。</div><div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;">手順はライブラリを読み込み、画像をひとコマ分ずつcanvasにロード、ライブラリに追加。終わったらバイナリからgifファイルを生成、という感じ。<br /><br />もう少し詳しい解説は以下。</div><ol style="font-family: helvetica, verdana, arial, serif; font-size: 14px;"><li><code>LZWEncoder.js</code>&nbsp;<code>NeuQuant.js</code>&nbsp;<code>GIFEncoder.js</code>&nbsp;を読み込む</li><li>適切なサイズの canvas を用意</li><li><code>GIFEncoder</code>&nbsp;からエンコーダを作る<br /><code>var encoder = new GIFEncoder();</code></li><li>アニメーションの時間間隔などを&nbsp;<code>encoder</code>&nbsp;に設定<br /><code>encoder.setRepeat(0);<br />encoder.setDelay(100);<br />encoder.setSize(120, 120);</code></li><li>一コマずつ書き始める<br /><code>encoder.start();</code><ol><li>canvas に絵を書く<br /><code>canvas.drawImage(img);</code></li><li><code>encoder</code>&nbsp;に canvas のコンテキストを追加することで一コマを追加<br /><code>encoder.addFrame(ctx);</code></li></ol></li><li>書き込み終了<br /><code>encoder.finish()</code></li><li><code>encoder</code>&nbsp;からバイナリを吐き出して、<code>Blob</code>を作る<br /><code>var bin = new Uint8Array(encoder.stream().bin);<br />var blob = new Blob([bin.buffer], {type: ‘image/gif’});</code></li><li><code>Blob</code>&nbsp;から URL を作って表示 (revoke を忘れずに)<br /><code>var url = URL.createObjectURL(blob);<br />var image = new Image();<br />image.src = url;<br />image.onload = function() {<br />&nbsp;URL.revokeObjectURL(url);<br />};</code></li></ol><div><div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;">デモは<a href="http://demo.agektmr.com/gif_anim/" style="color: #ad1020;">この辺</a>に。</div><div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;"><br /></div><div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;"><strike>※ このデモは Firefox 推奨です。Chrome では <a href="https://code.google.com/p/chromium/issues/detail?id=267279" target="_blank">img.onload で実際に画像が読み込まれない場合があるというバグ</a>のせいで、アニメーションが一部抜けたりしてしまいます。画像を読み込むのにAjaxを使うなどの回避方法はあるのですが、このデモでは可読性を優先して画像をsrcから読み込む方法を採りました。ただ、僕のコードにバグがある可能性もあるので、その場合は<a href="http://google.com/+agektmr" target="_blank">こっそり教えて</a>下さい :)</strike><br /><a href="https://plus.google.com/u/0/+agektmr/posts/fsCH9oUCkPQ" target="_blank">こっそりじゃないけど Google+ で教えてもらいました</a>。完全に僕の勘違いでした。お恥ずかしい・・・。</div><div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;"><br /></div><div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;"><a href="https://gist.github.com/agektmr/6131721" target="_blank">ソースコードはこちら</a>。</div><div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;"><br /></div><div style="font-family: helvetica, verdana, arial, serif; font-size: 14px;">参考：</div><ul><li><span style="font-family: helvetica, verdana, arial, serif; font-size: 14px;"><a href="http://antimatter15.com/wp/2010/07/javascript-to-animated-gif/" target="_blank">JavaScript </a></span></li></ul><ul><li><a href="http://uiureo.hatenablog.com/entry/2012/12/22/000852" style="font-family: helvetica, verdana, arial, serif; font-size: 14px;" target="_blank">pure JavaScriptでアニメーションGIFを作る</a></li></ul></div>